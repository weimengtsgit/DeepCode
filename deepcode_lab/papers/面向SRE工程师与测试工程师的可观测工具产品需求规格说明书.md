# 产品需求规格说明书 (PRD)

## 1. 产品概述

**产品名称**：智观（ZhiGuan）

**产品定位**：面向SRE工程师和测试工程师的全栈智能可观测平台，通过融合指标、日志、链路追踪和拓扑数据，提供从观测到根因分析再到自动化处置的闭环能力。

**核心价值**：
- 从"IT视角"转向"业务视角"，直接关联故障对业务的影响
- 通过AI智能分析，将故障定位时间从小时级缩短至分钟级
- 打通SRE与测试团队工作流，实现质量共建
- 适配国产化环境，满足数据合规要求

## 2. 目标用户

| 用户角色   | 使用场景                             | 核心需求                                                   |
| ---------- | ------------------------------------ | ---------------------------------------------------------- |
| SRE工程师  | 故障排查、SLI/SLO监控、自动化运维    | 快速定位问题根源、智能告警、自动化处置                     |
| 测试工程师 | 测试执行、测试效果验证、测试场景设计 | 测试用例与系统行为关联、测试效果量化分析、测试场景智能生成 |

## 3. 核心功能需求

### 3.1 数据采集与接入（P0）

**需求描述**：平台需支持多源数据采集，包括指标、日志和链路追踪数据，同时满足国产化环境要求。

**功能点**：
- 支持OpenTelemetry标准协议，兼容Java、Go、Python等主流语言SDK
- 提供Fluentd日志收集插件，支持Nginx、Tomcat等常见应用日志采集
- 为国产中间件（东方通、金仓等）提供专用采集插件
- 通过Agent实现基础设施指标采集（CPU、内存、磁盘等）
- 测试用例ID注入：在测试执行时，将test_case_id注入到请求头中，用于测试流量追踪

**验收标准**：
- 能够采集并处理100+种数据源
- 国产中间件数据采集成功率≥99.5%
- 测试用例ID注入成功率100%

### 3.2 数据融合与关联（P0）

**需求描述**：平台需将指标、日志、链路追踪数据进行关联，特别是要支持测试用例ID与系统数据的关联。

**功能点**：
- 通过统一的trace_id实现日志、指标、追踪数据的关联
- 通过test_case_id实现测试用例与系统行为的关联
- 构建业务指标与系统指标的关联模型
- 提供业务拓扑视图，展示业务组件间的依赖关系

**验收标准**：
- 95%以上的日志、指标、追踪数据能通过trace_id正确关联
- 100%的测试用例能通过test_case_id与系统行为关联
- 业务拓扑视图准确率≥90%

### 3.3 业务视角展示（P0）

**需求描述**：平台需从业务视角展示系统状态，而不是单纯的IT指标。

**功能点**：
- 业务健康度仪表盘：展示关键业务指标（支付成功率、登录成功率等）
- 业务流程图：展示业务关键路径，标注性能瓶颈
- 业务影响分析：展示故障对业务的具体影响（如"支付失败导致订单流失"）
- 业务SLI/SLO管理：支持自定义业务指标和SLA，设置告警阈值

**验收标准**：
- 业务健康度仪表盘数据更新延迟<30秒
- 业务流程图加载时间<2秒
- 业务影响分析准确率≥85%

### 3.4 智能分析能力（P0）

**需求描述**：平台需提供AI驱动的智能分析能力，帮助SRE工程师快速定位问题。

**功能点**：
- AI驱动的异常检测：自动识别系统异常，如"支付成功率突然下降"
- 根因分析：提供问题原因的智能建议，如"库存服务响应超时导致支付失败"
- 智能告警：基于业务影响的告警，减少告警风暴
- 业务影响预测：预测故障对业务的潜在影响

**验收标准**：
- 异常检测准确率≥85%
- 根因分析准确率≥75%
- 智能告警减少告警数量≥50%

### 3.5 SRE工作台（P0）

**需求描述**：为SRE工程师提供专门的工作台，支持日常运维工作。

**功能点**：
- 实时仪表盘：展示关键业务SLI、SLO和SLA
- 告警管理：智能告警分级，支持告警抑制和聚合
- 根因分析视图：展示问题链路和原因
- 自动化处置：预设处置脚本，支持一键处置
- SLO监控：实时监控SLO达成情况

**验收标准**：
- 仪表盘数据更新延迟<10秒
- 告警处理平均时间<5分钟
- 自动化处置成功率≥90%

### 3.6 测试工作台（P0）

**需求描述**：为测试工程师提供专门的工作台，支持测试全流程。

**功能点**：
- 测试用例关联：展示测试用例与系统行为的关联
- 测试场景分析：基于日志和指标的测试场景分析
- 测试效果验证：A/B测试效果对比，展示业务指标变化
- 测试流量追踪：可视化测试流量在微服务间的传递路径
- 测试场景智能生成：基于生产日志构造异常测试场景

**验收标准**：
- 测试用例关联准确率≥95%
- 测试场景分析结果与实际测试结果一致率≥85%
- 测试效果验证时间从2天缩短至2小时

### 3.7 国产化适配（P0）

**需求描述**：平台需适配国产化环境，满足信创要求。

**功能点**：
- 适配麒麟OS、统信UOS等国产操作系统
- 适配鲲鹏、飞腾等国产CPU架构
- 适配达梦、人大金仓等国产数据库
- 通过信创产品认证

**验收标准**：
- 在麒麟OS上安装部署成功率100%
- 在鲲鹏CPU上运行性能损失<10%
- 通过信创产品认证

### 3.8 数据合规（P0）

**需求描述**：平台需确保数据存储和传输符合国内合规要求。

**功能点**：
- 所有数据存储在国内数据中心
- 敏感数据加密存储和传输
- 记录所有数据访问行为，满足合规审计要求
- 提供数据导出和备份功能

**验收标准**：
- 数据存储符合等保三级要求
- 敏感数据加密传输成功率100%
- 审计日志完整率100%

## 4. 非功能需求

### 4.1 性能需求

| 指标                     | 目标值 | 说明                               |
| ------------------------ | ------ | ---------------------------------- |
| 指标数据采集延迟         | < 5秒  | 从数据产生到展示在仪表盘的时间     |
| 日志数据存储延迟         | < 10秒 | 从日志产生到可查询的时间           |
| 根因分析响应时间         | < 30秒 | 从告警触发到根因分析结果展示的时间 |
| 系统响应时间（页面加载） | < 2秒  | 95%的页面加载时间                  |
| 同时处理指标流           | 10万+  | 支持同时处理10万+指标流            |
| 日志存储容量             | 10TB+  | 支持10TB+日志数据存储              |

### 4.2 可用性需求

| 指标                  | 目标值  | 说明                       |
| --------------------- | ------- | -------------------------- |
| 系统可用性            | 99.9%   | 月度系统可用性目标         |
| 业务SLI/SLO监控实时性 | < 1分钟 | 业务指标更新延迟           |
| 告警通知延迟          | < 30秒  | 从问题发生到告警通知的时间 |

### 4.3 可扩展性需求

| 指标         | 目标值       | 说明                           |
| ------------ | ------------ | ------------------------------ |
| 业务组件支持 | 500+         | 支持500+个业务组件的拓扑展示   |
| 用户并发量   | 500+         | 支持500+用户同时使用           |
| 数据处理能力 | 10万+事件/秒 | 支持10万+事件/秒的数据处理能力 |

### 4.4 安全性需求

| 指标         | 目标值       | 说明               |
| ------------ | ------------ | ------------------ |
| 数据传输加密 | TLS 1.2+     | 所有数据传输加密   |
| 访问控制     | RBAC         | 基于角色的权限管理 |
| 审计日志     | 100%         | 记录所有关键操作   |
| 安全认证     | LDAP/AD、SSO | 支持企业级身份认证 |

## 5. 业务价值

| 业务指标      | 当前状态 | 目标状态 | 价值             |
| ------------- | -------- | -------- | ---------------- |
| 故障定位时间  | 2-4小时  | < 10分钟 | 提升效率40倍     |
| 告警准确率    | 30%      | > 85%    | 减少告警风暴     |
| SRE人力成本   | 100%     | 70%      | 降低运维成本30%  |
| 测试验证周期  | 2天      | 2小时    | 提升测试效率10倍 |
| 业务SLA达成率 | 95%      | 99.9%    | 提升客户满意度   |

## 6. 优先级排序

### P0（必须在V1.0中实现）

- 数据采集与接入（支持OpenTelemetry、Fluentd、国产中间件）
- 数据融合与关联（trace_id、test_case_id关联）
- 业务视角展示（业务健康度、业务流程图）
- SRE工作台核心功能（实时仪表盘、告警管理、根因分析）
- 测试工作台核心功能（测试用例关联、测试流量追踪）
- 国产化适配基础功能（适配麒麟OS、统信UOS）
- 数据合规（数据存储本地化、加密）

### P1（重要优先级，V1.1中实现）

- 智能分析能力（AI异常检测、根因分析）
- 测试场景智能生成
- SLO/SLO管理
- 与测试工具集成（Jenkins、JMeter）

### P2（一般优先级，V1.2中实现）

- 业务影响预测
- 自动化处置
- 扩展国产化适配（适配更多国产中间件）

## 7. 附录

### 7.1 术语解释

- **SLI**：服务级别指标（Service Level Indicator）
- **SLO**：服务级别目标（Service Level Objective）
- **SLA**：服务级别协议（Service Level Agreement）
- **OpenTelemetry**：开源观测性数据收集标准
- **trace_id**：分布式追踪的唯一标识符
- **test_case_id**：测试用例的唯一标识符

### 7.2 业务场景示例

**场景1：支付失败问题排查**
1. SRE工程师发现支付成功率下降
2. 通过业务健康度仪表盘确认问题
3. 使用根因分析功能快速定位到库存服务响应慢
4. 通过测试工作台查看相关测试用例，确认是库存服务的性能问题
5. 自动化处置触发，回滚到上一版本
6. 业务恢复正常，支付成功率恢复到99.9%

**场景2：新功能测试验证**
1. 测试工程师执行新功能测试
2. 测试用例ID注入到测试流量中
3. 通过测试工作台查看测试流量在微服务间的传递
4. 分析测试结果，确认新功能性能符合预期
5. 通过业务指标对比，确认新功能对支付成功率无负面影响
6. 确认功能可以发布

---

**备注**：本PRD是智观平台的初始版本需求，后续将根据用户反馈和业务发展进行迭代优化。所有功能点均经过与SRE工程师和测试工程师的深入沟通，确保满足实际工作需求。