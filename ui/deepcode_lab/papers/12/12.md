# Extracted from 12.pdf

*Total pages: 12*

---

## Page 1

WebPerf Scout — 完整需求规格说明书 版本：1.2主题：具备爬⾍能⼒与可视化控制台的 Web 软件性能分析与测评⼯具⽬标：通过声明式配置或图形界⾯，⾃动发现⻚⾯并执⾏性能测评，输出可量化、可对⽐、可追溯的专业报告适⽤对象：参赛开发者、AI 代码⽣成器、评审专家、前端⼯程师⼀、整体功能描述（Overall Functional Description） 1.1 产品定位 WebPerf Scout 是⼀个集智能爬⾍、真实浏览器性能测评与可视化控制台于⼀体的⾃动化⼯具。⽤户可通过以下任⼀⽅式启动性能分析：CLI 模式（⾯向⾃动化）：⼿动模式：显式列出关键⻚⾯ URL爬⾍模式：提供种⼦ URL，⾃动发现站点内⻚⾯Web Console 模式（⾯向交互）：图形化表单输⼊配置实时进度反馈图表化结果展示 + 历史记录回溯核⼼理念：“从⼊⼝出发，⾃动覆盖，精准测评，直观呈现”。1.2 核⼼价值主张 
✅
 ⾃动发现：内置轻量级爬⾍，从⾸⻚递归提取有效⻚⾯链接  
✅
 可控遍历：⽀持深度限制、域名⽩名单、路径排除、⻚⾯数量上限  
✅
 真实性能采集：基于 Playwright 在模拟设备/⽹络下采集 Web Vitals  
✅
 专业报告：输出含评分环、截图、指标卡、资源瀑布图的 HTML 报告  
✅
 CI/CD 友好：单命令运⾏，输出结构化 JSON + 静态 HTML  
✅
 可视化交互：本地 Web 控制台⽀持配置、实时进度、图表、历史记录1.3 ⽤户⼯作流（End-to-End Flow） CLI ⽤户 1. 编写配置：选择以下任⼀⽅式  ⽅式 A（⼿动）：在 targets 中列出 URL  ⽅式 B（爬⾍）：配置 crawler.seedUrl 等参数

## Page 2

类别包含（
✅
 In Scope）不包含（
❌
 Out of Scope）爬⾍能⼒单域内链接发现、深度控制、路径过滤、去重跨域爬取、登录后内容、JavaScript 动态路由（如React Router ⽆ SSR）⻚⾯类型静态⻚、SSR SPA、含 <a href> 的⻚⾯需交互触发跳转的⻚⾯（如点击按钮才出现新链接）性能测评LCP/FCP/CLS/TTI/TBT/resourceLoadTime⾃定义 RUM 指标（除⾮通过 JS 表达式定义）部署CLI ⼯具、Docker 容器、本地 Web 控制台SaaS 服务、多⽤户管理、公⽹远程访问Web 控制台本地运⾏、历史记录、图表展示⽤户认证、团队协作、云存储2. 执⾏命令：webperf-scout run --spec perf-spec.yaml  3. 系统⾃动执⾏：  若为爬⾍模式 → 启动爬取引擎，⽣成 URL 列表  为每个⻚⾯ × 设备组合启动性能测评4. ⽣成报告：report.html + report.json  5. 查看/集成：⼈⼯审阅或接⼊⾃动化流程Web Console ⽤户 1. 启动控制台：npm run web 或 docker run -p 3000:3000 webperf-scout:web  2. 在浏览器中打开 http://localhost:3000  3. 填写图形化表单（⽀持⼿动或爬⾍模式）  4. 点击“开始分析” → 查看实时进度与⽇志流  5. 分析完成 → ⾃动跳转⾄图表化报告⻚  6. （可选）保存记录、导出 JSON、回溯历史1.4 能⼒边界（In Scope / Out of Scope） 
1.5 典型使⽤场景 全站性能巡检：给定⾸⻚ URL，⾃动测评全站 50 个核⼼⻚⾯在⼿机 4G 下的表现  上线前回归测试：PR 合并前，爬取 staging 环境关键路径，确保⽆性能退化  竞品分析：对公开⽹站（如电商⾸⻚）进⾏⾃动发现 + 性能打分  开发调试：前端⼯程师本地启动 Web 控制台，快速验证⻚⾯性能变化1.6 ⼀句话定义 WebPerf Scout 是⼀个“爬⾍ + 性能 + 可视化”三位⼀体的⼯具，从⼀个⼊⼝ URL 出发，⾃动发现⻚⾯、完成专业级 Web 性能测评，并通过 CLI 或 Web 界⾯输出可视化报告。⼆、后端功能清单（Backend Modules）

## Page 3

⼆、后端功能清单（Backend Modules） 注：以下模块同时服务于 CLI 与 Web Console2.1 CLI ⼊⼝模块（cli/main） 职责：接收命令，启动测评流程  输⼊：--spec <path>（必填），--output-dir（默认 ./reports/），--verbose  输出：report.html + report.json，或错误退出（code=1）  ⾏为：解析参数 → 校验 spec → 初始化⽇志 → 调度任务 → ⽣成报告约束：⽆交互；路径相对当前⼯作⽬录2.2 Spec 解析与校验模块（spec/validator） 职责：加载并验证 perf-spec.yaml 或等效 JSON 对象  输⼊：YAML/JSON ⽂件路径 或 内存对象（来⾃ Web 表单）  输出：标准化内部对象，或 ValidationError  校验规则：version: "1.0"targets 和 crawler 互斥且必选其⼀若存在 crawler，则必须包含 seedUrlurl 必须为 HTTPSdevice ∈ ["Desktop", Playwright 内置设备名]metrics ∈ 预定义集合 或 ⾃定义 JS 指标crawler.maxDepth：默认 2，最⼤ 5crawler.maxPages：默认 30，最⼤ 100crawler.includeDomains：默认 [new URL(seedUrl).hostname]crawler.excludePatterns：字符串数组（⽀持⼦串匹配）约束：错误信息需⼈类可读（如 “第5⾏：缺少 url”）2.3 任务调度器（engine/orchestrator） 职责：展开任务矩阵并并发执⾏  输⼊：已校验 spec  输出：TaskResult[]（每个 target × deviceProfile ⼀个结果）  ⾏为：若 spec 含 targets → 直接使⽤若 spec 含 crawler → 调⽤ discoverUrls(crawlerConfig) 获取 URL 列表，并转换为 targets 格式（name = pathname）

## Page 4

⽣成 K = N×M 个任务并发执⾏（默认 ≤ CPU 核数，上限 8）独⽴浏览器上下⽂（⽆状态污染）失败重试 ≤2 次（指数退避）约束：单任务总超时 ≤30 秒2.4 Playwright 性能采集器（engine/playwright-runner） 职责：在真实浏览器中加载⻚⾯并采集指标  输⼊：url, deviceProfile（含 device/network/cpuThrottle）  输出：{ metrics, screenshotBase64, resources }  ⾏为：启动 Chromium via Playwright应⽤设备模拟（viewport/userAgent）应⽤⽹络节流（4G/3G/WiFi）通过 CDP 应⽤ CPU 节流（Emulation.setCPUThrottlingRate）导航到 URL注⼊指标脚本采集 Web Vitals截图 + 获取资源列表指标采集⽅式：lcp/fcp/cls：Google web-vitals@4 库tti：实现 Lighthouse TTI 算法totalBlockingTime：Long Tasks APIresourceLoadTime：performance.navigation.loadEventEnd安全约束：禁⽌执⾏任意⽤户 JS禁⽌ file://爬取深度 = 12.5 性能评分与分析器（engine/analyzer） 职责：计算综合评分并标记异常  输⼊：原始指标值  输出：score: 0–100, alerts: []  评分公式：

## Page 5

告警阈值：LCP > 2500 msFCP > 1800 msTTI > 3500 msTBT > 200 msCLS > 0.12.6 报告⽣成器（report/generator） 职责：⽣成 HTML 和 JSON 报告  输⼊：TaskResult[] + 时间戳  输出：report.html：嵌⼊数据的静态⻚⾯report.json：结构化数据HTML ⽣成：读取 public/report-template.html替换 {{REPORT_DATA_JSON}} 为序列化数据JSON 结构：score = 100  - max(0, lcp - 2500) * 0.03  - max(0, fcp - 1800) * 0.055  - max(0, tti - 3500) * 0.028  - totalBlockingTime * 0.1  - cls * 1000 * 0.15score = clamp(round(score), 0, 100)
{  "specVersion": "1.0",  "runAt": "2025-12-11T14:00:00Z",  "results": [    {      "targetName": "/",      "deviceProfile": "Mobile_4G",      "metrics": {        "lcp": 2800,        "fcp": 1200,        "tti": 3100,        "totalBlockingTime": 180,        "cls": 0.05,        "resourceLoadTime": 3200      },      "score": 72,      "screenshotBase64": "data:image/png;base64,...",      "resources": [

## Page 6

2.7 智能爬取模块（crawler/discoverer） 职责：从种⼦ URL ⾃动发现待测⻚⾯集合  输⼊：
输出：Promise<{ url: string; name: string }[]>（最多 maxPages 个）⾏为逻辑：1. 初始化队列：[{ url: seedUrl, depth: 0 }]2. 初始化已访问集合（Set）3. While 队列⾮空 且 结果数 < maxPages：出队⼀个 URL若已访问 → 跳过若域名不在 includeDomains → 跳过若路径匹配任意 excludePatterns（⼦串匹配）→ 跳过使⽤ Playwright 加载该⻚⾯（快速模式，禁⽤图⽚/媒体）执⾏ JS 提取所有 <a[href]>：对每个新链接：若 depth + 1 ≤ maxDepth → ⼊队将当前 URL 加⼊结果列表（name = new URL(url).pathname）标记为已访问4. 返回结果列表（按发现顺序）安全约束：        { "url": "https://example.com/", "duration": 3200, "startTime": 0 },        { "url": "https://example.com/main.js", "duration": 800, "startTime": 400 }      ]    }  ]}
{  seedUrl: string;  maxDepth: number;       // 默认 2  maxPages: number;       // 默认 30  includeDomains: string[]; // 默认 [seedUrl 域名]  excludePatterns: string[]; // 如 ["/admin", "/api"]}
Array.from(document.querySelectorAll('a[href]'))  .map(a => new URL(a.href, document.baseURI).href)  .filter(href => href.startsWith('http'))

## Page 7

单⻚⾯加载超时 ≤ 10 秒总爬取时间 ≤ 2 分钟通过 page.route() 拦截⾮ text/html 资源（提升速度）User-Agent 标识为 WebPerfScout-Crawler/1.0三、前端功能清单（HTML 报告 UI） 3.1 整体设计 响应式：适配桌⾯/⼿机浏览器⻛格：现代卡⽚式，绿⾊/橙⾊/红⾊表示性能状态字体：系统⽆衬线字体（如 -apple-system, 'Segoe UI'）3.2 核⼼组件 (1) 标题与时间 显示：“WebPerf Scout 性能报告”显示运⾏时间（如 “2025年12⽉11⽇ 14:00”）(2) 综合评分环 圆形进度环，显示 0–100 分颜⾊：≥90：绿⾊50–89：橙⾊<50：红⾊(3) ⻚⾯切换 Tab 每个 “⻚⾯ × 设备” ⼀个 Tab默认激活第⼀个点击切换内容（前端 JS 动态渲染）(4) 指标卡⽚区 ⽹格布局（响应式）每卡含：指标名（LCP）、值（2.8 s）、状态⾊（根据阈值）

## Page 8

(5) ⻚⾯截图 显示 base64 截图最⼤宽度 100%，圆⻆边框(6) 资源瀑布图（简化） 列出前 20 个资源每⾏：URL（截断）+ 耗时（如 “1.2 s”）按 startTime 排序3.3 交互逻辑 ⻚⾯加载时读取内联 REPORT_DATA 变量渲染默认⻚⾯内容Tab 切换时更新指标/截图/资源列表⾃动应⽤颜⾊类（good/warning/bad）3.4 数据绑定 后端注⼊：前端直接使⽤该变量渲染四、Web 可视化控制台（Web Console Extension） 4.1 产品定位 作为 webperf-scout 的可选 Web 前端组件与 CLI 共享同⼀后端引擎（engine/orchestrator 等模块）⽀持本地开发模式运⾏（npm run dev）或 Docker 部署不替代 CLI，⽽是提供更友好的⼈机交互层4.2 核⼼功能清单 (1) 配置输⼊表单（Configuration Form） 表单项包括：测试模式切换：   ⼿动输⼊ URL 列表  <script>  const REPORT_DATA = { /* report.json 内容 */ };</script>

## Page 9

⾃动爬取（默认）若选择“⾃动爬取”：种⼦ URL（必填，HTTPS）最⼤深度（滑块，1–5，默认 2）最⼤⻚⾯数（数字输⼊，1–100，默认 30）排除路径（多⾏⽂本，如 /admin, /api）若选择“⼿动输⼊”：多⾏⽂本框，每⾏⼀个 name|url（如 ⾸⻚|https://example.com）设备配置：设备下拉框（含 "Desktop", "iPhone 12", "Pixel 5" 等 Playwright 内置选项）⽹络条件（"4G", "3G", "WiFi"）指标选择（复选框）：LCP / FCP / TTI / CLS / TBT实时校验：URL 格式、必填项、互斥逻辑（同 spec validator）(2) 启动与实时进度⾯板（Real-time Progress Dashboard） 点击 “开始分析” → 调⽤本地 API（如 /api/run）启动任务进度显示：总体进度条（0% → 100%）当前阶段标签：正在爬取... / 正在测评 /about...实时⽇志流（滚动输出，含 level: info/warn/error）取消按钮（可中断当前任务）(3) 图表化性能指标展示（Chart-based Metrics Visualization） 任务完成后⾃动跳转⾄结果⻚⽀持按“⻚⾯ × 设备”筛选图表类型：雷达图：展示 LCP/FCP/TTI/CLS/TBT 五维性能（标准化到 0–100）柱状图：对⽐多个⻚⾯的 LCP 或综合评分时间序列图（若启⽤历史记录）：展示同⼀⻚⾯多次测评的趋势每个图表下⽅附原始数值表格（可排序）(4) 历史记录管理（Historical Runs） 本地存储最近 20 次运⾏记录（IndexedDB / SQLite）记录内容：运⾏时间使⽤的配置摘要（种⼦ URL / ⻚⾯数 / 设备）平均分、⻚⾯数、状态（成功/失败）

## Page 10

项⽬要求前端框架React + Vite（轻量、快速启动）状态管理Zustand（简单共享状态）图表库Chart.js（兼容性好、体积⼩）后端 APIExpress + WebSocket（⽤于实时⽇志推送）与 CLI 共享复⽤ spec/validator、engine/*、report/generator 模块部署⽅式开发：localhost:3000；⽣产：Docker 镜像（含 Node.js + 静态服务）安全仅限 localhost 或内⽹访问（默认不暴露公⽹）类别要求爬⾍安全性默认限深=2、限⻚=30；禁⽌跨域；⾃动排除 /admin、/api 等路径可复现性相同 spec + 相同环境 → 相同输出（含截图）性能爬取阶段：单⻚ ≤10s；测评阶段：单⻚×设备 ≤15s（4C8G 机器）安全性仅 HTTPS；⽆任意 JS 执⾏；⽆⽂件写⼊⻛险⽇志结构化 JSON ⽇志，输出 stdout，含 level/task/message部署提供 Dockerfile（node:20-alpine）兼容性⽀持 Chromium、Firefox（Playwright）Web 控制台仅限本地运⾏；不收集⽤户数据；⽆外部依赖⽀持：点击某次记录 → 重新加载完整报告（含截图、资源列表）删除单条或清空全部导出为 report.json ⽂件4.3 技术约束 
五、⾮功能性要求 
六、交付物（MVP） 1. CLI ⼯具：⽀持 targets（⼿动）和 crawler（⾃动）两种模式  2. 静态报告：report.html（含所有被测⻚⾯性能数据）  3. 结构化数据：report.json

## Page 11

4. Web 可视化控制台：前端：React 应⽤（web-console/ ⽬录）后端 API：Express 服务（复⽤ CLI 引擎）启动命令：npm run web 或 docker run -p 3000:3000 webperf-scout:web5. 示例配置examples/manual-spec.yaml（⼿动列表）examples/crawler-spec.yaml（⾃动爬取）6. 使⽤⽂档：README.md（含安装、运⾏、CI 集成、Web 控制台启动说明）7. 集成示例：examples/web-demo.gif（演示配置→运⾏→查看历史）web-console/README.md七、附录：Spec 示例 ⼿动模式（manual-spec.yaml） 
爬⾍模式（crawler-spec.yaml） 
备注：Web Console 的配置表单将上述 YAML 字段映射为图形控件，最终仍转换为等效 spec 对象传⼊统⼀引擎。version: "1.0"targets:  - name: ⾸⻚    url: https://example.com  - name: 关于我们    url: https://example.com/aboutdeviceProfiles:  - device: "Desktop"    network: "WiFi"metrics: ["lcp", "fcp", "cls"]version: "1.0"crawler:  seedUrl: https://example.com  maxDepth: 2  maxPages: 20  excludePatterns: ["/admin", "/api", "/login"]deviceProfiles:  - device: "iPhone 12"    network: "4G"metrics: ["lcp", "fcp", "tti", "cls"]

